!function(e,t){"function"==typeof define&&define.amd?define("vxe-table-plugin-export-xlsx",["exports","xe-utils","exceljs"],t):"undefined"!=typeof exports?t(exports,require("xe-utils"),require("exceljs")):(t(t={},e.XEUtils,e.ExcelJS),e.VXETablePluginExportXLSX=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e,j,M){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}var N;Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.VXETablePluginExportXLSX=void 0,j=t(j),M=t(M);var O="f8f8f9",R="606266",o="thin",n="e8eaec";function A(e,t){if(t)switch(e.cellType){case"string":return j.default.toValueString(t);case"number":if(!isNaN(t))return Number(t);break;default:if(t.length<12&&!isNaN(t))return Number(t)}return t}function D(e,t){t&&(e.height=j.default.floor(.75*t,12))}function I(e,t){e.protection={locked:!1},e.alignment={vertical:"middle",horizontal:t||"left"}}function L(){return{top:{style:o,color:{argb:n}},left:{style:o,color:{argb:n}},bottom:{style:o,color:{argb:n}},right:{style:o,color:{argb:n}}}}function r(e){var i="xlsx",s=N.modal,c=N.t,r=e.$table,u=e.options,f=e.columns,t=e.colgroups,o=e.datas,n=r.props,a=r.reactData,l=n.headerAlign,d=n.align,p=n.footerAlign,g=a.rowHeight,e=u.message,h=u.sheetName,m=u.isHeader,b=u.isFooter,n=u.isMerge,a=u.isColgroup,v=u.original,x=u.useStyle,w=u.sheetMethod,y=!1!==e,e=r.getMergeCells(),E=[],k=[],C=[],S=[],T=0,X={};f.forEach(function(e){var t=e.id,o=e.property,n=e.renderWidth;X[t]=v?o:e.getTitle(),C.push({key:t,width:j.default.ceil(n/8,1)})}),m&&(a&&!v&&t?t.forEach(function(e,a){var l={};f.forEach(function(e){l[e.id]=null}),e.forEach(function(e){var t=e._colSpan,o=e._rowSpan,n=function e(t){var o=t.childNodes;return o&&o.length?e(o[0]):t}(e),r=f.indexOf(n);l[n.id]=v?n.property:e.getTitle(),(1<t||1<o)&&S.push({s:{r:a,c:r},e:{r:a+o-1,c:r+t-1}})}),E.push(l)}):E.push(X),T+=E.length),n&&!v&&e.forEach(function(e){var t=e.row,o=e.rowspan,n=e.col,e=e.colspan;S.push({s:{r:t+T,c:n},e:{r:t+T+o-1,c:n+e-1}})});var B,V=o.map(function(t){var o={};return f.forEach(function(e){o[e.id]=A(e,t[e.id])}),o});T+=V.length,b&&(_=r.getTableData().footerData,e=_,_=(B=u.footerFilterMethod)?e.filter(function(e,t){return B({items:e,$rowIndex:t})}):e,e=r.getMergeFooterItems(),n&&!v&&e.forEach(function(e){var t=e.row,o=e.rowspan,n=e.col,e=e.colspan;S.push({s:{r:t+T,c:n},e:{r:t+T+o-1,c:n+e-1}})}),_.forEach(function(t){var o={};f.forEach(function(e){o[e.id]=A(e=e,t[r.getVMColumnIndex(e)])}),k.push(o)}));var _=function(){var e=new M.default.Workbook,n=e.addWorksheet(h);e.creator="vxe-table",n.columns=C,m&&n.addRows(E).forEach(function(e){x&&D(e,g),e.eachCell(function(e){var t=n.getColumn(e.col),o=r.getColumnById(t.key),t=o.headerAlign,o=o.align;I(e,t||o||l||d),x&&Object.assign(e,{font:{bold:!0,color:{argb:R}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:O}},border:L()})})}),n.addRows(V).forEach(function(e){x&&D(e,g),e.eachCell(function(e){var t=n.getColumn(e.col);I(e,r.getColumnById(t.key).align||d),x&&Object.assign(e,{font:{color:{argb:R}},border:L()})})}),b&&n.addRows(k).forEach(function(e){x&&D(e,g),e.eachCell(function(e){var t=n.getColumn(e.col),o=r.getColumnById(t.key),t=o.footerAlign,o=o.align;I(e,t||o||p||d),x&&Object.assign(e,{font:{color:{argb:R}},border:L()})})}),x&&w&&w({options:u,workbook:e,worksheet:n,columns:f,colgroups:t,datas:o,$table:r}),S.forEach(function(e){var t=e.s,e=e.e;n.mergeCells(t.r+1,t.c+1,e.r+1,e.c+1)}),e.xlsx.writeBuffer().then(function(e){var t,o,n,r,a,l=new Blob([e],{type:"application/octet-stream"});t=l,o=u,n=N.modal,r=N.t,a=o.message,e=o.filename,l=o.type,o=!1!==a,window.Blob?navigator.msSaveBlob?navigator.msSaveBlob(t,"".concat(e,".").concat(l)):((a=document.createElement("a")).target="_blank",a.download="".concat(e,".").concat(l),a.href=URL.createObjectURL(t),document.body.appendChild(a),a.click(),document.body.removeChild(a)):o&&n&&n.alert({content:r("vxe.error.notExp"),status:"error"}),y&&s&&(s.close(i),s.message({content:c("vxe.table.expSuccess"),status:"success"}))})};y&&s?(s.message({id:i,content:c("vxe.table.expLoading"),status:"loading",duration:-1}),setTimeout(_,1500)):_()}function d(e){var t=N.modal,o=N.t,n=e.$table,e=e.options,n=n.internalData._importReject;!1!==e.message&&t&&t.message({content:o("vxe.error.impFields"),status:"error"}),n&&n({status:!1})}function a(a){var l=N.modal,i=N.t,s=a.$table,o=a.columns,c=a.options,e=a.file,u=s.internalData._importResolve,f=!1!==c.message,t=new FileReader;t.onerror=function(){d(a)},t.onload=function(e){var r=[];o.forEach(function(e){e=e.property;e&&r.push(e)});var t=new M.default.Workbook,e=e.target;e?t.xlsx.load(e.result).then(function(e){var n,t,o=e.worksheets[0];o?(e=o.getSheetValues(),o=j.default.findIndexOf(e,function(e){return e&&0<e.length}),n=e[o],(t=r,n.some(function(e){return-1<t.indexOf(e)}))?(o=e.slice(o).map(function(e){var o={};e.forEach(function(e,t){o[n[t]]=e});var t={};return r.forEach(function(e){t[e]=j.default.isUndefined(o[e])?null:o[e]}),t}),s.createData(o).then(function(e){e="insert"===c.mode?s.insertAt(e,-1):s.reloadData(e);return e.then(function(){u&&u({status:!0})})}),f&&l&&l.message({content:i("vxe.table.impSuccess",[o.length]),status:"success"})):d(a)):d(a)}):d(a)},t.readAsArrayBuffer(e)}function l(e){if("xlsx"===e.options.type)return a(e),!1}function i(e){if("xlsx"===e.options.type)return r(e),!1}var s={install:function(e){var t=e.setup,o=e.interceptor;N=e,t({export:{types:{xlsx:0}}}),o.mixin({"event.import":l,"event.export":i})}};e.VXETablePluginExportXLSX=s,"undefined"!=typeof window&&window.VXETable&&window.VXETable.use&&window.VXETable.use(s),e.default=s});
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginExportXLSX = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils"));

var _exceljs = _interopRequireDefault(require("exceljs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var vxetable;
var defaultHeaderBackgroundColor = 'f8f8f9';
var defaultCellFontColor = '606266';
var defaultCellBorderStyle = 'thin';
var defaultCellBorderColor = 'e8eaec';

function getCellLabel(column, cellValue) {
  if (cellValue) {
    switch (column.cellType) {
      case 'string':
        return _xeUtils["default"].toValueString(cellValue);

      case 'number':
        if (!isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;

      default:
        if (cellValue.length < 12 && !isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;
    }
  }

  return cellValue;
}

function getFooterData(opts, footerData) {
  var footerFilterMethod = opts.footerFilterMethod;
  return footerFilterMethod ? footerData.filter(function (items, index) {
    return footerFilterMethod({
      items: items,
      $rowIndex: index
    });
  }) : footerData;
}

function getFooterCellValue($table, opts, rows, column) {
  var cellValue = getCellLabel(column, rows[$table.getVMColumnIndex(column)]);
  return cellValue;
}

function getValidColumn(column) {
  var childNodes = column.childNodes;
  var isColGroup = childNodes && childNodes.length;

  if (isColGroup) {
    return getValidColumn(childNodes[0]);
  }

  return column;
}

function setExcelRowHeight(excelRow, height) {
  if (height) {
    excelRow.height = _xeUtils["default"].floor(height * 0.75, 12);
  }
}

function setExcelCellStyle(excelCell, align) {
  excelCell.protection = {
    locked: false
  };
  excelCell.alignment = {
    vertical: 'middle',
    horizontal: align || 'left'
  };
}

function getDefaultBorderStyle() {
  return {
    top: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    left: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    bottom: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    right: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    }
  };
}

function exportXLSX(params) {
  var msgKey = 'xlsx';
  var _vxetable = vxetable,
      modal = _vxetable.modal,
      t = _vxetable.t;
  var $table = params.$table,
      options = params.options,
      columns = params.columns,
      colgroups = params.colgroups,
      datas = params.datas;
  var props = $table.props,
      reactData = $table.reactData;
  var allHeaderAlign = props.headerAlign,
      allAlign = props.align,
      allFooterAlign = props.footerAlign;
  var rowHeight = reactData.rowHeight;
  var message = options.message,
      sheetName = options.sheetName,
      isHeader = options.isHeader,
      isFooter = options.isFooter,
      isMerge = options.isMerge,
      isColgroup = options.isColgroup,
      original = options.original,
      useStyle = options.useStyle,
      sheetMethod = options.sheetMethod;
  var showMsg = message !== false;
  var mergeCells = $table.getMergeCells();
  var colList = [];
  var footList = [];
  var sheetCols = [];
  var sheetMerges = [];
  var beforeRowCount = 0;
  var colHead = {};
  columns.forEach(function (column) {
    var id = column.id,
        property = column.property,
        renderWidth = column.renderWidth;
    colHead[id] = original ? property : column.getTitle();
    sheetCols.push({
      key: id,
      width: _xeUtils["default"].ceil(renderWidth / 8, 1)
    });
  }); // 处理表头

  if (isHeader) {
    // 处理分组
    if (isColgroup && !original && colgroups) {
      colgroups.forEach(function (cols, rIndex) {
        var groupHead = {};
        columns.forEach(function (column) {
          groupHead[column.id] = null;
        });
        cols.forEach(function (column) {
          var _colSpan = column._colSpan,
              _rowSpan = column._rowSpan;
          var validColumn = getValidColumn(column);
          var columnIndex = columns.indexOf(validColumn);
          groupHead[validColumn.id] = original ? validColumn.property : column.getTitle();

          if (_colSpan > 1 || _rowSpan > 1) {
            sheetMerges.push({
              s: {
                r: rIndex,
                c: columnIndex
              },
              e: {
                r: rIndex + _rowSpan - 1,
                c: columnIndex + _colSpan - 1
              }
            });
          }
        });
        colList.push(groupHead);
      });
    } else {
      colList.push(colHead);
    }

    beforeRowCount += colList.length;
  } // 处理合并


  if (isMerge && !original) {
    mergeCells.forEach(function (mergeItem) {
      var mergeRowIndex = mergeItem.row,
          mergeRowspan = mergeItem.rowspan,
          mergeColIndex = mergeItem.col,
          mergeColspan = mergeItem.colspan;
      sheetMerges.push({
        s: {
          r: mergeRowIndex + beforeRowCount,
          c: mergeColIndex
        },
        e: {
          r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
          c: mergeColIndex + mergeColspan - 1
        }
      });
    });
  }

  var rowList = datas.map(function (item) {
    var rest = {};
    columns.forEach(function (column) {
      rest[column.id] = getCellLabel(column, item[column.id]);
    });
    return rest;
  });
  beforeRowCount += rowList.length; // 处理表尾

  if (isFooter) {
    var _$table$getTableData = $table.getTableData(),
        footerData = _$table$getTableData.footerData;

    var footers = getFooterData(options, footerData);
    var mergeFooterItems = $table.getMergeFooterItems(); // 处理合并

    if (isMerge && !original) {
      mergeFooterItems.forEach(function (mergeItem) {
        var mergeRowIndex = mergeItem.row,
            mergeRowspan = mergeItem.rowspan,
            mergeColIndex = mergeItem.col,
            mergeColspan = mergeItem.colspan;
        sheetMerges.push({
          s: {
            r: mergeRowIndex + beforeRowCount,
            c: mergeColIndex
          },
          e: {
            r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
            c: mergeColIndex + mergeColspan - 1
          }
        });
      });
    }

    footers.forEach(function (rows) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = getFooterCellValue($table, options, rows, column);
      });
      footList.push(item);
    });
  }

  var exportMethod = function exportMethod() {
    var workbook = new _exceljs["default"].Workbook();
    var sheet = workbook.addWorksheet(sheetName);
    workbook.creator = 'vxe-table';
    sheet.columns = sheetCols;

    if (isHeader) {
      sheet.addRows(colList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);
          var headerAlign = column.headerAlign,
              align = column.align;
          setExcelCellStyle(excelCell, headerAlign || align || allHeaderAlign || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                bold: true,
                color: {
                  argb: defaultCellFontColor
                }
              },
              fill: {
                type: 'pattern',
                pattern: 'solid',
                fgColor: {
                  argb: defaultHeaderBackgroundColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        });
      });
    }

    sheet.addRows(rowList).forEach(function (excelRow) {
      if (useStyle) {
        setExcelRowHeight(excelRow, rowHeight);
      }

      excelRow.eachCell(function (excelCell) {
        var excelCol = sheet.getColumn(excelCell.col);
        var column = $table.getColumnById(excelCol.key);
        var align = column.align;
        setExcelCellStyle(excelCell, align || allAlign);

        if (useStyle) {
          Object.assign(excelCell, {
            font: {
              color: {
                argb: defaultCellFontColor
              }
            },
            border: getDefaultBorderStyle()
          });
        }
      });
    });

    if (isFooter) {
      sheet.addRows(footList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);
          var footerAlign = column.footerAlign,
              align = column.align;
          setExcelCellStyle(excelCell, footerAlign || align || allFooterAlign || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                color: {
                  argb: defaultCellFontColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        });
      });
    }

    if (useStyle && sheetMethod) {
      sheetMethod({
        options: options,
        workbook: workbook,
        worksheet: sheet,
        columns: columns,
        colgroups: colgroups,
        datas: datas,
        $table: $table
      });
    }

    sheetMerges.forEach(function (_ref) {
      var s = _ref.s,
          e = _ref.e;
      sheet.mergeCells(s.r + 1, s.c + 1, e.r + 1, e.c + 1);
    });
    workbook.xlsx.writeBuffer().then(function (buffer) {
      var blob = new Blob([buffer], {
        type: 'application/octet-stream'
      }); // 导出 xlsx

      downloadFile(params, blob, options);

      if (showMsg && modal) {
        modal.close(msgKey);
        modal.message({
          content: t('vxe.table.expSuccess'),
          status: 'success'
        });
      }
    });
  };

  if (showMsg && modal) {
    modal.message({
      id: msgKey,
      content: t('vxe.table.expLoading'),
      status: 'loading',
      duration: -1
    });
    setTimeout(exportMethod, 1500);
  } else {
    exportMethod();
  }
}

function downloadFile(params, blob, options) {
  var _vxetable2 = vxetable,
      modal = _vxetable2.modal,
      t = _vxetable2.t;
  var message = options.message,
      filename = options.filename,
      type = options.type;
  var showMsg = message !== false;

  if (window.Blob) {
    if (navigator.msSaveBlob) {
      navigator.msSaveBlob(blob, "".concat(filename, ".").concat(type));
    } else {
      var linkElem = document.createElement('a');
      linkElem.target = '_blank';
      linkElem.download = "".concat(filename, ".").concat(type);
      linkElem.href = URL.createObjectURL(blob);
      document.body.appendChild(linkElem);
      linkElem.click();
      document.body.removeChild(linkElem);
    }
  } else {
    if (showMsg && modal) {
      modal.alert({
        content: t('vxe.error.notExp'),
        status: 'error'
      });
    }
  }
}

function checkImportData(tableFields, fields) {
  return fields.some(function (field) {
    return tableFields.indexOf(field) > -1;
  });
}

function importError(params) {
  var _vxetable3 = vxetable,
      modal = _vxetable3.modal,
      t = _vxetable3.t;
  var $table = params.$table,
      options = params.options;
  var internalData = $table.internalData;
  var _importReject = internalData._importReject;
  var showMsg = options.message !== false;

  if (showMsg && modal) {
    modal.message({
      content: t('vxe.error.impFields'),
      status: 'error'
    });
  }

  if (_importReject) {
    _importReject({
      status: false
    });
  }
}

function importXLSX(params) {
  var _vxetable4 = vxetable,
      modal = _vxetable4.modal,
      t = _vxetable4.t;
  var $table = params.$table,
      columns = params.columns,
      options = params.options,
      file = params.file;
  var internalData = $table.internalData;
  var _importResolve = internalData._importResolve;
  var showMsg = options.message !== false;
  var fileReader = new FileReader();

  fileReader.onerror = function () {
    importError(params);
  };

  fileReader.onload = function (evnt) {
    var tableFields = [];
    columns.forEach(function (column) {
      var field = column.property;

      if (field) {
        tableFields.push(field);
      }
    });
    var workbook = new _exceljs["default"].Workbook();
    var readerTarget = evnt.target;

    if (readerTarget) {
      workbook.xlsx.load(readerTarget.result).then(function (wb) {
        var firstSheet = wb.worksheets[0];

        if (firstSheet) {
          var sheetValues = firstSheet.getSheetValues();

          var fieldIndex = _xeUtils["default"].findIndexOf(sheetValues, function (list) {
            return list && list.length > 0;
          });

          var fields = sheetValues[fieldIndex];
          var status = checkImportData(tableFields, fields);

          if (status) {
            var records = sheetValues.slice(fieldIndex).map(function (list) {
              var item = {};
              list.forEach(function (cellValue, cIndex) {
                item[fields[cIndex]] = cellValue;
              });
              var record = {};
              tableFields.forEach(function (field) {
                record[field] = _xeUtils["default"].isUndefined(item[field]) ? null : item[field];
              });
              return record;
            });
            $table.createData(records).then(function (data) {
              var loadRest;

              if (options.mode === 'insert') {
                loadRest = $table.insertAt(data, -1);
              } else {
                loadRest = $table.reloadData(data);
              }

              return loadRest.then(function () {
                if (_importResolve) {
                  _importResolve({
                    status: true
                  });
                }
              });
            });

            if (showMsg && modal) {
              modal.message({
                content: t('vxe.table.impSuccess', [records.length]),
                status: 'success'
              });
            }
          } else {
            importError(params);
          }
        } else {
          importError(params);
        }
      });
    } else {
      importError(params);
    }
  };

  fileReader.readAsArrayBuffer(file);
}

function handleImportEvent(params) {
  if (params.options.type === 'xlsx') {
    importXLSX(params);
    return false;
  }
}

function handleExportEvent(params) {
  if (params.options.type === 'xlsx') {
    exportXLSX(params);
    return false;
  }
}
/**
 * 基于 vxe-table 表格的增强插件，支持导出 xlsx 格式
 */


var VXETablePluginExportXLSX = {
  install: function install(vxetablecore) {
    var setup = vxetablecore.setup,
        interceptor = vxetablecore.interceptor;
    vxetable = vxetablecore;
    setup({
      "export": {
        types: {
          xlsx: 0
        }
      }
    });
    interceptor.mixin({
      'event.import': handleImportEvent,
      'event.export': handleExportEvent
    });
  }
};
exports.VXETablePluginExportXLSX = VXETablePluginExportXLSX;

if (typeof window !== 'undefined' && window.VXETable && window.VXETable.use) {
  window.VXETable.use(VXETablePluginExportXLSX);
}

var _default = VXETablePluginExportXLSX;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiaW5kZXguanMiXSwibmFtZXMiOlsidnhldGFibGUiLCJkZWZhdWx0SGVhZGVyQmFja2dyb3VuZENvbG9yIiwiZGVmYXVsdENlbGxGb250Q29sb3IiLCJkZWZhdWx0Q2VsbEJvcmRlclN0eWxlIiwiZGVmYXVsdENlbGxCb3JkZXJDb2xvciIsImdldENlbGxMYWJlbCIsImNvbHVtbiIsImNlbGxWYWx1ZSIsImNlbGxUeXBlIiwiWEVVdGlscyIsInRvVmFsdWVTdHJpbmciLCJpc05hTiIsIk51bWJlciIsImxlbmd0aCIsImdldEZvb3RlckRhdGEiLCJvcHRzIiwiZm9vdGVyRGF0YSIsImZvb3RlckZpbHRlck1ldGhvZCIsImZpbHRlciIsIml0ZW1zIiwiaW5kZXgiLCIkcm93SW5kZXgiLCJnZXRGb290ZXJDZWxsVmFsdWUiLCIkdGFibGUiLCJyb3dzIiwiZ2V0Vk1Db2x1bW5JbmRleCIsImdldFZhbGlkQ29sdW1uIiwiY2hpbGROb2RlcyIsImlzQ29sR3JvdXAiLCJzZXRFeGNlbFJvd0hlaWdodCIsImV4Y2VsUm93IiwiaGVpZ2h0IiwiZmxvb3IiLCJzZXRFeGNlbENlbGxTdHlsZSIsImV4Y2VsQ2VsbCIsImFsaWduIiwicHJvdGVjdGlvbiIsImxvY2tlZCIsImFsaWdubWVudCIsInZlcnRpY2FsIiwiaG9yaXpvbnRhbCIsImdldERlZmF1bHRCb3JkZXJTdHlsZSIsInRvcCIsInN0eWxlIiwiY29sb3IiLCJhcmdiIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0IiwiZXhwb3J0WExTWCIsInBhcmFtcyIsIm1zZ0tleSIsIm1vZGFsIiwidCIsIm9wdGlvbnMiLCJjb2x1bW5zIiwiY29sZ3JvdXBzIiwiZGF0YXMiLCJwcm9wcyIsInJlYWN0RGF0YSIsImFsbEhlYWRlckFsaWduIiwiaGVhZGVyQWxpZ24iLCJhbGxBbGlnbiIsImFsbEZvb3RlckFsaWduIiwiZm9vdGVyQWxpZ24iLCJyb3dIZWlnaHQiLCJtZXNzYWdlIiwic2hlZXROYW1lIiwiaXNIZWFkZXIiLCJpc0Zvb3RlciIsImlzTWVyZ2UiLCJpc0NvbGdyb3VwIiwib3JpZ2luYWwiLCJ1c2VTdHlsZSIsInNoZWV0TWV0aG9kIiwic2hvd01zZyIsIm1lcmdlQ2VsbHMiLCJnZXRNZXJnZUNlbGxzIiwiY29sTGlzdCIsImZvb3RMaXN0Iiwic2hlZXRDb2xzIiwic2hlZXRNZXJnZXMiLCJiZWZvcmVSb3dDb3VudCIsImNvbEhlYWQiLCJmb3JFYWNoIiwiaWQiLCJwcm9wZXJ0eSIsInJlbmRlcldpZHRoIiwiZ2V0VGl0bGUiLCJwdXNoIiwia2V5Iiwid2lkdGgiLCJjZWlsIiwiY29scyIsInJJbmRleCIsImdyb3VwSGVhZCIsIl9jb2xTcGFuIiwiX3Jvd1NwYW4iLCJ2YWxpZENvbHVtbiIsImNvbHVtbkluZGV4IiwiaW5kZXhPZiIsInMiLCJyIiwiYyIsImUiLCJtZXJnZUl0ZW0iLCJtZXJnZVJvd0luZGV4Iiwicm93IiwibWVyZ2VSb3dzcGFuIiwicm93c3BhbiIsIm1lcmdlQ29sSW5kZXgiLCJjb2wiLCJtZXJnZUNvbHNwYW4iLCJjb2xzcGFuIiwicm93TGlzdCIsIm1hcCIsIml0ZW0iLCJyZXN0IiwiZ2V0VGFibGVEYXRhIiwiZm9vdGVycyIsIm1lcmdlRm9vdGVySXRlbXMiLCJnZXRNZXJnZUZvb3Rlckl0ZW1zIiwiZXhwb3J0TWV0aG9kIiwid29ya2Jvb2siLCJFeGNlbEpTIiwiV29ya2Jvb2siLCJzaGVldCIsImFkZFdvcmtzaGVldCIsImNyZWF0b3IiLCJhZGRSb3dzIiwiZWFjaENlbGwiLCJleGNlbENvbCIsImdldENvbHVtbiIsImdldENvbHVtbkJ5SWQiLCJPYmplY3QiLCJhc3NpZ24iLCJmb250IiwiYm9sZCIsImZpbGwiLCJ0eXBlIiwicGF0dGVybiIsImZnQ29sb3IiLCJib3JkZXIiLCJ3b3Jrc2hlZXQiLCJ4bHN4Iiwid3JpdGVCdWZmZXIiLCJ0aGVuIiwiYnVmZmVyIiwiYmxvYiIsIkJsb2IiLCJkb3dubG9hZEZpbGUiLCJjbG9zZSIsImNvbnRlbnQiLCJzdGF0dXMiLCJkdXJhdGlvbiIsInNldFRpbWVvdXQiLCJmaWxlbmFtZSIsIndpbmRvdyIsIm5hdmlnYXRvciIsIm1zU2F2ZUJsb2IiLCJsaW5rRWxlbSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRhcmdldCIsImRvd25sb2FkIiwiaHJlZiIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImNsaWNrIiwicmVtb3ZlQ2hpbGQiLCJhbGVydCIsImNoZWNrSW1wb3J0RGF0YSIsInRhYmxlRmllbGRzIiwiZmllbGRzIiwic29tZSIsImZpZWxkIiwiaW1wb3J0RXJyb3IiLCJpbnRlcm5hbERhdGEiLCJfaW1wb3J0UmVqZWN0IiwiaW1wb3J0WExTWCIsImZpbGUiLCJfaW1wb3J0UmVzb2x2ZSIsImZpbGVSZWFkZXIiLCJGaWxlUmVhZGVyIiwib25lcnJvciIsIm9ubG9hZCIsImV2bnQiLCJyZWFkZXJUYXJnZXQiLCJsb2FkIiwicmVzdWx0Iiwid2IiLCJmaXJzdFNoZWV0Iiwid29ya3NoZWV0cyIsInNoZWV0VmFsdWVzIiwiZ2V0U2hlZXRWYWx1ZXMiLCJmaWVsZEluZGV4IiwiZmluZEluZGV4T2YiLCJsaXN0IiwicmVjb3JkcyIsInNsaWNlIiwiY0luZGV4IiwicmVjb3JkIiwiaXNVbmRlZmluZWQiLCJjcmVhdGVEYXRhIiwiZGF0YSIsImxvYWRSZXN0IiwibW9kZSIsImluc2VydEF0IiwicmVsb2FkRGF0YSIsInJlYWRBc0FycmF5QnVmZmVyIiwiaGFuZGxlSW1wb3J0RXZlbnQiLCJoYW5kbGVFeHBvcnRFdmVudCIsIlZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWCIsImluc3RhbGwiLCJ2eGV0YWJsZWNvcmUiLCJzZXR1cCIsImludGVyY2VwdG9yIiwidHlwZXMiLCJtaXhpbiIsIlZYRVRhYmxlIiwidXNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7Ozs7QUFFQSxJQUFJQSxRQUFKO0FBaUJBLElBQU1DLDRCQUE0QixHQUFHLFFBQXJDO0FBQ0EsSUFBTUMsb0JBQW9CLEdB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Q05FLFFBQUFBLEtBQUssRUFBRTtBQUNMM0UsVUFBQUEsSUFBSSxFQUFFO0FBREQ7QUFERDtBQURKLEtBQUQsQ0FBTDtBQU9BMEUsSUFBQUEsV0FBVyxDQUFDRSxLQUFaLENBQWtCO0FBQ2hCLHNCQUFnQlIsaUJBREE7QUFFaEIsc0JBQWdCQztBQUZBLEtBQWxCO0FBSUQ7QUFqQnFDLENBQWpDOzs7QUFvQlAsSUFBSSxPQUFPeEQsTUFBUCxLQUFrQixXQUFsQixJQUFpQ0EsTUFBTSxDQUFDZ0UsUUFBeEMsSUFBb0RoRSxNQUFNLENBQUNnRSxRQUFQLENBQWdCQyxHQUF4RSxFQUE2RTtBQUMzRWpFLEVBQUFBLE1BQU0sQ0FBQ2dFLFFBQVAsQ0FBZ0JDLEdBQWhCLENBQW9CUix3QkFBcEI7QUFDRDs7ZUFFY0Esd0IiLCJmaWxlIjoiaW5kZXguY29tbW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFhFVXRpbHMgZnJvbSAneGUtdXRpbHMnXHJcbmltcG9ydCB7IFZYRVRhYmxlQ29yZSwgVnhlVGFibGVDb25zdHJ1Y3RvciwgVnhlVGFibGVQcm9wVHlwZXMsIFZ4ZVRhYmxlRGVmaW5lcywgVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzIH0gZnJvbSAndnhlLXRhYmxlJ1xyXG5pbXBvcnQgRXhjZWxKUyBmcm9tICdleGNlbGpzJ1xyXG5cclxubGV0IHZ4ZXRhYmxlOlZYRVRhYmxlQ29yZVxyXG5cclxuZGVjbGFyZSBtb2R1bGUgJ3Z4ZS10YWJsZScge1xyXG4gIG5hbWVzcGFjZSBWeGVUYWJsZURlZmluZXMge1xyXG4gICAgaW50ZXJmYWNlIEV4dG9ydFNoZWV0TWV0aG9kUGFyYW1zIHtcclxuICAgICAgd29ya2Jvb2s6IEV4Y2VsSlMuV29ya2Jvb2s7XHJcbiAgICAgIHdvcmtzaGVldDogRXhjZWxKUy5Xb3Jrc2hlZXQ7XHJcbiAgICB9XHJcbiAgICBpbnRlcmZhY2UgQ29sdW1uSW5mbyB7XHJcbiAgICAgIF9yb3c6IGFueTtcclxuICAgICAgX2NvbFNwYW46IG51bWJlcjtcclxuICAgICAgX3Jvd1NwYW46IG51bWJlcjtcclxuICAgICAgY2hpbGROb2RlczogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm9bXTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGRlZmF1bHRIZWFkZXJCYWNrZ3JvdW5kQ29sb3IgPSAnZjhmOGY5J1xyXG5jb25zdCBkZWZhdWx0Q2VsbEZvbnRDb2xvciA9ICc2MDYyNjYnXHJcbmNvbnN0IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUgPSAndGhpbidcclxuY29uc3QgZGVmYXVsdENlbGxCb3JkZXJDb2xvciA9ICdlOGVhZWMnXHJcblxyXG5mdW5jdGlvbiBnZXRDZWxsTGFiZWwgKGNvbHVtbjogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8sIGNlbGxWYWx1ZTogYW55KSB7XHJcbiAgaWYgKGNlbGxWYWx1ZSkge1xyXG4gICAgc3dpdGNoIChjb2x1bW4uY2VsbFR5cGUpIHtcclxuICAgICAgY2FzZSAnc3RyaW5nJzpcclxuICAgICAgICByZXR1cm4gWEVVdGlscy50b1ZhbHVlU3RyaW5nKGNlbGxWYWx1ZSlcclxuICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICBpZiAoIWlzTmFOKGNlbGxWYWx1ZSkpIHtcclxuICAgICAgICAgIHJldHVybiBOdW1iZXIoY2VsbFZhbHVlKVxyXG4gICAgICAgIH1cclxuICAgICAgICBicmVha1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIGlmIChjZWxsVmFsdWUubGVuZ3RoIDwgMTIgJiYgIWlzTmFOKGNlbGxWYWx1ZSkpIHtcclxuICAgICAgICAgIHJldHVybiBOdW1iZXIoY2VsbFZhbHVlKVxyXG4gICAgICAgIH1cclxuICAgICAgICBicmVha1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gY2VsbFZhbHVlXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEZvb3RlckRhdGEgKG9wdHM6IFZ4ZVRhYmxlUHJvcFR5cGVzLkV4cG9ydENvbmZpZywgZm9vdGVyRGF0YTogYW55W11bXSkge1xyXG4gIGNvbnN0IHsgZm9vdGVyRmlsdGVyTWV0aG9kIH0gPSBvcHRzXHJcbiAgcmV0dXJuIGZvb3RlckZpbHRlck1ldGhvZCA/IGZvb3RlckRhdGEuZmlsdGVyKChpdGVtcywgaW5kZXgpID0+IGZvb3RlckZpbHRlck1ldGhvZCh7IGl0ZW1zLCAkcm93SW5kZXg6IGluZGV4IH0pKSA6IGZvb3RlckRhdGFcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Rm9vdGVyQ2VsbFZhbHVlICgkdGFibGU6IFZ4ZVRhYmxlQ29uc3RydWN0b3IsIG9wdHM6IFZ4ZVRhYmxlUHJvcFR5cGVzLkV4cG9ydENvbmZpZywgcm93czogYW55W10sIGNvbHVtbjogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8pIHtcclxuICBjb25zdCBjZWxsVmFsdWUgPSBnZXRDZWxsTGFiZWwoY29sdW1uLCByb3dzWyR0YWJsZS5nZXRWTUNvbHVtbkluZGV4KGNvbHVtbildKVxyXG4gIHJldHVybiBjZWxsVmFsdWVcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VmFsaWRDb2x1bW4gKGNvbHVtbjogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8pOiBWeGVUYWJsZURlZmluZXMuQ29sdW1uSW5mbyB7XHJcbiAgY29uc3QgeyBjaGlsZE5vZGVzIH0gPSBjb2x1bW5cclxuICBjb25zdCBpc0NvbEdyb3VwID0gY2hpbGROb2RlcyAmJiBjaGlsZE5vZGVzLmxlbmd0aFxyXG4gIGlmIChpc0NvbEdyb3VwKSB7XHJcbiAgICByZXR1cm4gZ2V0VmFsaWRDb2x1bW4oY2hpbGROb2Rlc1swXSlcclxuICB9XHJcbiAgcmV0dXJuIGNvbHVtblxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFeGNlbFJvd0hlaWdodCAoZXhjZWxSb3c6IEV4Y2VsSlMuUm93LCBoZWlnaHQ6IG51bWJlcikge1xyXG4gIGlmIChoZWlnaHQpIHtcclxuICAgIGV4Y2VsUm93LmhlaWdodCA9IFhFVXRpbHMuZmxvb3IoaGVpZ2h0ICogMC43NSwgMTIpXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFeGNlbENlbGxTdHlsZSAoZXhjZWxDZWxsOiBFeGNlbEpTLkNlbGwsIGFsaWduPzogVnhlVGFibGVQcm9wVHlwZXMuQWxpZ24gfCBWeGVUYWJsZVByb3BUeXBlcy5IZWFkZXJBbGlnbiB8IFZ4ZVRhYmxlUHJvcFR5cGVzLkZvb3RlckFsaWduKSB7XHJcbiAgZXhjZWxDZWxsLnByb3RlY3Rpb24gPSB7XHJcbiAgICBsb2NrZWQ6IGZhbHNlXHJcbiAgfVxyXG4gIGV4Y2VsQ2VsbC5hbGlnbm1lbnQgPSB7XHJcbiAgICB2ZXJ0aWNhbDogJ21pZGRsZScsXHJcbiAgICBob3Jpem9udGFsOiBhbGlnbiB8fCAnbGVmdCdcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldERlZmF1bHRCb3JkZXJTdHlsZSAoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHRvcDoge1xyXG4gICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcclxuICAgICAgY29sb3I6IHtcclxuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBsZWZ0OiB7XHJcbiAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxyXG4gICAgICBjb2xvcjoge1xyXG4gICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGJvdHRvbToge1xyXG4gICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcclxuICAgICAgY29sb3I6IHtcclxuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICByaWdodDoge1xyXG4gICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcclxuICAgICAgY29sb3I6IHtcclxuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4cG9ydFhMU1ggKHBhcmFtczogVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzLkludGVyY2VwdG9yRXhwb3J0UGFyYW1zKSB7XHJcbiAgY29uc3QgbXNnS2V5ID0gJ3hsc3gnXHJcbiAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGVcclxuICBjb25zdCB7ICR0YWJsZSwgb3B0aW9ucywgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcyB9ID0gcGFyYW1zXHJcbiAgY29uc3QgeyBwcm9wcywgcmVhY3REYXRhIH0gPSAkdGFibGVcclxuICBjb25zdCB7IGhlYWRlckFsaWduOiBhbGxIZWFkZXJBbGlnbiwgYWxpZ246IGFsbEFsaWduLCBmb290ZXJBbGlnbjogYWxsRm9vdGVyQWxpZ24gfSA9IHByb3BzXHJcbiAgY29uc3QgeyByb3dIZWlnaHQgfSA9IHJlYWN0RGF0YVxyXG4gIGNvbnN0IHsgbWVzc2FnZSwgc2hlZXROYW1lLCBpc0hlYWRlciwgaXNGb290ZXIsIGlzTWVyZ2UsIGlzQ29sZ3JvdXAsIG9yaWdpbmFsLCB1c2VTdHlsZSwgc2hlZXRNZXRob2QgfSA9IG9wdGlvbnNcclxuICBjb25zdCBzaG93TXNnID0gbWVzc2FnZSAhPT0gZmFsc2VcclxuICBjb25zdCBtZXJnZUNlbGxzID0gJHRhYmxlLmdldE1lcmdlQ2VsbHMoKVxyXG4gIGNvbnN0IGNvbExpc3Q6IGFueVtdID0gW11cclxuICBjb25zdCBmb290TGlzdDogYW55W10gPSBbXVxyXG4gIGNvbnN0IHNoZWV0Q29sczogYW55W10gPSBbXVxyXG4gIGNvbnN0IHNoZWV0TWVyZ2VzOiB7IHM6IHsgcjogbnVtYmVyLCBjOiBudW1iZXIgfSwgZTogeyByOiBudW1iZXIsIGM6IG51bWJlciB9IH1bXSA9IFtdXHJcbiAgbGV0IGJlZm9yZVJvd0NvdW50ID0gMFxyXG4gIGNvbnN0IGNvbEhlYWQ6IGFueSA9IHt9XHJcbiAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgIGNvbnN0IHsgaWQsIHByb3BlcnR5LCByZW5kZXJXaWR0aCB9ID0gY29sdW1uXHJcbiAgICBjb2xIZWFkW2lkXSA9IG9yaWdpbmFsID8gcHJvcGVydHkgOiBjb2x1bW4uZ2V0VGl0bGUoKVxyXG4gICAgc2hlZXRDb2xzLnB1c2goe1xyXG4gICAgICBrZXk6IGlkLFxyXG4gICAgICB3aWR0aDogWEVVdGlscy5jZWlsKHJlbmRlcldpZHRoIC8gOCwgMSlcclxuICAgIH0pXHJcbiAgfSlcclxuICAvLyDlpITnkIbooajlpLRcclxuICBpZiAoaXNIZWFkZXIpIHtcclxuICAgIC8vIOWkhOeQhuWIhue7hFxyXG4gICAgaWYgKGlzQ29sZ3JvdXAgJiYgIW9yaWdpbmFsICYmIGNvbGdyb3Vwcykge1xyXG4gICAgICBjb2xncm91cHMuZm9yRWFjaCgoY29scywgckluZGV4KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZ3JvdXBIZWFkOiBhbnkgPSB7fVxyXG4gICAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XHJcbiAgICAgICAgICBncm91cEhlYWRbY29sdW1uLmlkXSA9IG51bGxcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbHMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCB7IF9jb2xTcGFuLCBfcm93U3BhbiB9ID0gY29sdW1uXHJcbiAgICAgICAgICBjb25zdCB2YWxpZENvbHVtbiA9IGdldFZhbGlkQ29sdW1uKGNvbHVtbilcclxuICAgICAgICAgIGNvbnN0IGNvbHVtbkluZGV4ID0gY29sdW1ucy5pbmRleE9mKHZhbGlkQ29sdW1uKVxyXG4gICAgICAgICAgZ3JvdXBIZWFkW3ZhbGlkQ29sdW1uLmlkXSA9IG9yaWdpbmFsID8gdmFsaWRDb2x1bW4ucHJvcGVydHkgOiBjb2x1bW4uZ2V0VGl0bGUoKVxyXG4gICAgICAgICAgaWYgKF9jb2xTcGFuID4gMSB8fCBfcm93U3BhbiA+IDEpIHtcclxuICAgICAgICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgczogeyByOiBySW5kZXgsIGM6IGNvbHVtbkluZGV4IH0sXHJcbiAgICAgICAgICAgICAgZTogeyByOiBySW5kZXggKyBfcm93U3BhbiAtIDEsIGM6IGNvbHVtbkluZGV4ICsgX2NvbFNwYW4gLSAxIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbExpc3QucHVzaChncm91cEhlYWQpXHJcbiAgICAgIH0pXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb2xMaXN0LnB1c2goY29sSGVhZClcclxuICAgIH1cclxuICAgIGJlZm9yZVJvd0NvdW50ICs9IGNvbExpc3QubGVuZ3RoXHJcbiAgfVxyXG4gIC8vIOWkhOeQhuWQiOW5tlxyXG4gIGlmIChpc01lcmdlICYmICFvcmlnaW5hbCkge1xyXG4gICAgbWVyZ2VDZWxscy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgcm93OiBtZXJnZVJvd0luZGV4LCByb3dzcGFuOiBtZXJnZVJvd3NwYW4sIGNvbDogbWVyZ2VDb2xJbmRleCwgY29sc3BhbjogbWVyZ2VDb2xzcGFuIH0gPSBtZXJnZUl0ZW1cclxuICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XHJcbiAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcclxuICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIGNvbnN0IHJvd0xpc3QgPSBkYXRhcy5tYXAoaXRlbSA9PiB7XHJcbiAgICBjb25zdCByZXN0OiBhbnkgPSB7fVxyXG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgICAgcmVzdFtjb2x1bW4uaWRdID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgaXRlbVtjb2x1bW4uaWRdKVxyXG4gICAgfSlcclxuICAgIHJldHVybiByZXN0XHJcbiAgfSlcclxuICBiZWZvcmVSb3dDb3VudCArPSByb3dMaXN0Lmxlbmd0aFxyXG4gIC8vIOWkhOeQhuihqOWwvlxyXG4gIGlmIChpc0Zvb3Rlcikge1xyXG4gICAgY29uc3QgeyBmb290ZXJEYXRhIH0gPSAkdGFibGUuZ2V0VGFibGVEYXRhKClcclxuICAgIGNvbnN0IGZvb3RlcnMgPSBnZXRGb290ZXJEYXRhKG9wdGlvbnMsIGZvb3RlckRhdGEpXHJcbiAgICBjb25zdCBtZXJnZUZvb3Rlckl0ZW1zID0gJHRhYmxlLmdldE1lcmdlRm9vdGVySXRlbXMoKVxyXG4gICAgLy8g5aSE55CG5ZCI5bm2XHJcbiAgICBpZiAoaXNNZXJnZSAmJiAhb3JpZ2luYWwpIHtcclxuICAgICAgbWVyZ2VGb290ZXJJdGVtcy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XHJcbiAgICAgICAgY29uc3QgeyByb3c6IG1lcmdlUm93SW5kZXgsIHJvd3NwYW46IG1lcmdlUm93c3BhbiwgY29sOiBtZXJnZUNvbEluZGV4LCBjb2xzcGFuOiBtZXJnZUNvbHNwYW4gfSA9IG1lcmdlSXRlbVxyXG4gICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xyXG4gICAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcclxuICAgICAgICAgIGU6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50ICsgbWVyZ2VSb3dzcGFuIC0gMSwgYzogbWVyZ2VDb2xJbmRleCArIG1lcmdlQ29sc3BhbiAtIDEgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBmb290ZXJzLmZvckVhY2goKHJvd3MpID0+IHtcclxuICAgICAgY29uc3QgaXRlbTogYW55ID0ge31cclxuICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgICAgICBpdGVtW2NvbHVtbi5pZF0gPSBnZXRGb290ZXJDZWxsVmFsdWUoJHRhYmxlLCBvcHRpb25zLCByb3dzLCBjb2x1bW4pXHJcbiAgICAgIH0pXHJcbiAgICAgIGZvb3RMaXN0LnB1c2goaXRlbSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIGNvbnN0IGV4cG9ydE1ldGhvZCA9ICgpID0+IHtcclxuICAgIGNvbnN0IHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKVxyXG4gICAgY29uc3Qgc2hlZXQgPSB3b3JrYm9vay5hZGRXb3Jrc2hlZXQoc2hlZXROYW1lKVxyXG4gICAgd29ya2Jvb2suY3JlYXRvciA9ICd2eGUtdGFibGUnXHJcbiAgICBzaGVldC5jb2x1bW5zID0gc2hlZXRDb2xzXHJcbiAgICBpZiAoaXNIZWFkZXIpIHtcclxuICAgICAgc2hlZXQuYWRkUm93cyhjb2xMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcclxuICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKVxyXG4gICAgICAgICAgY29uc3QgY29sdW1uOiBhbnkgPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkgYXMgc3RyaW5nKVxyXG4gICAgICAgICAgY29uc3QgeyBoZWFkZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBoZWFkZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxIZWFkZXJBbGlnbiB8fCBhbGxBbGlnbilcclxuICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZmlsbDoge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3BhdHRlcm4nLFxyXG4gICAgICAgICAgICAgICAgcGF0dGVybjogJ3NvbGlkJyxcclxuICAgICAgICAgICAgICAgIGZnQ29sb3I6IHtcclxuICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdEhlYWRlckJhY2tncm91bmRDb2xvclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBzaGVldC5hZGRSb3dzKHJvd0xpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xyXG4gICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KVxyXG4gICAgICB9XHJcbiAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbClcclxuICAgICAgICBjb25zdCBjb2x1bW46IGFueSA9ICR0YWJsZS5nZXRDb2x1bW5CeUlkKGV4Y2VsQ29sLmtleSBhcyBzdHJpbmcpXHJcbiAgICAgICAgY29uc3QgeyBhbGlnbiB9ID0gY29sdW1uXHJcbiAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBhbGlnbiB8fCBhbGxBbGlnbilcclxuICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXhjZWxDZWxsLCB7XHJcbiAgICAgICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxGb250Q29sb3JcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJvcmRlcjogZ2V0RGVmYXVsdEJvcmRlclN0eWxlKClcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICAgIGlmIChpc0Zvb3Rlcikge1xyXG4gICAgICBzaGVldC5hZGRSb3dzKGZvb3RMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcclxuICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKVxyXG4gICAgICAgICAgY29uc3QgY29sdW1uOiBhbnkgPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkgYXMgc3RyaW5nKVxyXG4gICAgICAgICAgY29uc3QgeyBmb290ZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBmb290ZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxGb290ZXJBbGlnbiB8fCBhbGxBbGlnbilcclxuICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiB7XHJcbiAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIGlmICh1c2VTdHlsZSAmJiBzaGVldE1ldGhvZCkge1xyXG4gICAgICBzaGVldE1ldGhvZCh7IG9wdGlvbnM6IG9wdGlvbnMsIHdvcmtib29rLCB3b3Jrc2hlZXQ6IHNoZWV0LCBjb2x1bW5zLCBjb2xncm91cHMsIGRhdGFzLCAkdGFibGUgfSlcclxuICAgIH1cclxuICAgIHNoZWV0TWVyZ2VzLmZvckVhY2goKHsgcywgZSB9KSA9PiB7XHJcbiAgICAgIHNoZWV0Lm1lcmdlQ2VsbHMocy5yICsgMSwgcy5jICsgMSwgZS5yICsgMSwgZS5jICsgMSlcclxuICAgIH0pXHJcbiAgICB3b3JrYm9vay54bHN4LndyaXRlQnVmZmVyKCkudGhlbihidWZmZXIgPT4ge1xyXG4gICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2J1ZmZlcl0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScgfSlcclxuICAgICAgLy8g5a+85Ye6IHhsc3hcclxuICAgICAgZG93bmxvYWRGaWxlKHBhcmFtcywgYmxvYiwgb3B0aW9ucylcclxuICAgICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcclxuICAgICAgICBtb2RhbC5jbG9zZShtc2dLZXkpXHJcbiAgICAgICAgbW9kYWwubWVzc2FnZSh7IGNvbnRlbnQ6IHQoJ3Z4ZS50YWJsZS5leHBTdWNjZXNzJyksIHN0YXR1czogJ3N1Y2Nlc3MnIH0pXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG4gIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICBtb2RhbC5tZXNzYWdlKHsgaWQ6IG1zZ0tleSwgY29udGVudDogdCgndnhlLnRhYmxlLmV4cExvYWRpbmcnKSwgc3RhdHVzOiAnbG9hZGluZycsIGR1cmF0aW9uOiAtMSB9KVxyXG4gICAgc2V0VGltZW91dChleHBvcnRNZXRob2QsIDE1MDApXHJcbiAgfSBlbHNlIHtcclxuICAgIGV4cG9ydE1ldGhvZCgpXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBkb3dubG9hZEZpbGUgKHBhcmFtczogVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzLkludGVyY2VwdG9yRXhwb3J0UGFyYW1zLCBibG9iOiBCbG9iLCBvcHRpb25zOiBWeGVUYWJsZVByb3BUeXBlcy5FeHBvcnRDb25maWcpIHtcclxuICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZVxyXG4gIGNvbnN0IHsgbWVzc2FnZSwgZmlsZW5hbWUsIHR5cGUgfSA9IG9wdGlvbnNcclxuICBjb25zdCBzaG93TXNnID0gbWVzc2FnZSAhPT0gZmFsc2VcclxuICBpZiAod2luZG93LkJsb2IpIHtcclxuICAgIGlmICgobmF2aWdhdG9yIGFzIGFueSkubXNTYXZlQmxvYikge1xyXG4gICAgICAobmF2aWdhdG9yIGFzIGFueSkubXNTYXZlQmxvYihibG9iLCBgJHtmaWxlbmFtZX0uJHt0eXBlfWApXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBsaW5rRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKVxyXG4gICAgICBsaW5rRWxlbS50YXJnZXQgPSAnX2JsYW5rJ1xyXG4gICAgICBsaW5rRWxlbS5kb3dubG9hZCA9IGAke2ZpbGVuYW1lfS4ke3R5cGV9YFxyXG4gICAgICBsaW5rRWxlbS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKVxyXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmtFbGVtKVxyXG4gICAgICBsaW5rRWxlbS5jbGljaygpXHJcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGlua0VsZW0pXHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICAgIG1vZGFsLmFsZXJ0KHsgY29udGVudDogdCgndnhlLmVycm9yLm5vdEV4cCcpLCBzdGF0dXM6ICdlcnJvcicgfSlcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrSW1wb3J0RGF0YSAodGFibGVGaWVsZHM6IHN0cmluZ1tdLCBmaWVsZHM6IHN0cmluZ1tdKSB7XHJcbiAgcmV0dXJuIGZpZWxkcy5zb21lKGZpZWxkID0+IHRhYmxlRmllbGRzLmluZGV4T2YoZmllbGQpID4gLTEpXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGltcG9ydEVycm9yIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckltcG9ydFBhcmFtcykge1xyXG4gIGNvbnN0IHsgbW9kYWwsIHQgfSA9IHZ4ZXRhYmxlXHJcbiAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMgfSA9IHBhcmFtc1xyXG4gIGNvbnN0IHsgaW50ZXJuYWxEYXRhIH0gPSAkdGFibGVcclxuICBjb25zdCB7IF9pbXBvcnRSZWplY3QgfSA9IGludGVybmFsRGF0YVxyXG4gIGNvbnN0IHNob3dNc2cgPSBvcHRpb25zLm1lc3NhZ2UgIT09IGZhbHNlXHJcbiAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcclxuICAgIG1vZGFsLm1lc3NhZ2UoeyBjb250ZW50OiB0KCd2eGUuZXJyb3IuaW1wRmllbGRzJyksIHN0YXR1czogJ2Vycm9yJyB9KVxyXG4gIH1cclxuICBpZiAoX2ltcG9ydFJlamVjdCkge1xyXG4gICAgX2ltcG9ydFJlamVjdCh7IHN0YXR1czogZmFsc2UgfSlcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGltcG9ydFhMU1ggKHBhcmFtczogVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzLkludGVyY2VwdG9ySW1wb3J0UGFyYW1zKSB7XHJcbiAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGVcclxuICBjb25zdCB7ICR0YWJsZSwgY29sdW1ucywgb3B0aW9ucywgZmlsZSB9ID0gcGFyYW1zXHJcbiAgY29uc3QgeyBpbnRlcm5hbERhdGEgfSA9ICR0YWJsZVxyXG4gIGNvbnN0IHsgX2ltcG9ydFJlc29sdmUgfSA9IGludGVybmFsRGF0YVxyXG4gIGNvbnN0IHNob3dNc2cgPSBvcHRpb25zLm1lc3NhZ2UgIT09IGZhbHNlXHJcbiAgY29uc3QgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcclxuICBmaWxlUmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICBpbXBvcnRFcnJvcihwYXJhbXMpXHJcbiAgfVxyXG4gIGZpbGVSZWFkZXIub25sb2FkID0gKGV2bnQpID0+IHtcclxuICAgIGNvbnN0IHRhYmxlRmllbGRzOiBzdHJpbmdbXSA9IFtdXHJcbiAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xyXG4gICAgICBjb25zdCBmaWVsZCA9IGNvbHVtbi5wcm9wZXJ0eVxyXG4gICAgICBpZiAoZmllbGQpIHtcclxuICAgICAgICB0YWJsZUZpZWxkcy5wdXNoKGZpZWxkKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgY29uc3Qgd29ya2Jvb2sgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpXHJcbiAgICBjb25zdCByZWFkZXJUYXJnZXQgPSBldm50LnRhcmdldFxyXG4gICAgaWYgKHJlYWRlclRhcmdldCkge1xyXG4gICAgICB3b3JrYm9vay54bHN4LmxvYWQocmVhZGVyVGFyZ2V0LnJlc3VsdCBhcyBBcnJheUJ1ZmZlcikudGhlbih3YiA9PiB7XHJcbiAgICAgICAgY29uc3QgZmlyc3RTaGVldCA9IHdiLndvcmtzaGVldHNbMF1cclxuICAgICAgICBpZiAoZmlyc3RTaGVldCkge1xyXG4gICAgICAgICAgY29uc3Qgc2hlZXRWYWx1ZXMgPSBmaXJzdFNoZWV0LmdldFNoZWV0VmFsdWVzKCkgYXMgc3RyaW5nW11bXVxyXG4gICAgICAgICAgY29uc3QgZmllbGRJbmRleCA9IFhFVXRpbHMuZmluZEluZGV4T2Yoc2hlZXRWYWx1ZXMsIChsaXN0KSA9PiBsaXN0ICYmIGxpc3QubGVuZ3RoID4gMClcclxuICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IHNoZWV0VmFsdWVzW2ZpZWxkSW5kZXhdIGFzIHN0cmluZ1tdXHJcbiAgICAgICAgICBjb25zdCBzdGF0dXMgPSBjaGVja0ltcG9ydERhdGEodGFibGVGaWVsZHMsIGZpZWxkcylcclxuICAgICAgICAgIGlmIChzdGF0dXMpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IHNoZWV0VmFsdWVzLnNsaWNlKGZpZWxkSW5kZXgpLm1hcChsaXN0ID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBpdGVtIDogYW55ID0ge31cclxuICAgICAgICAgICAgICBsaXN0LmZvckVhY2goKGNlbGxWYWx1ZSwgY0luZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtW2ZpZWxkc1tjSW5kZXhdXSA9IGNlbGxWYWx1ZVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgY29uc3QgcmVjb3JkOiBhbnkgPSB7fVxyXG4gICAgICAgICAgICAgIHRhYmxlRmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVjb3JkW2ZpZWxkXSA9IFhFVXRpbHMuaXNVbmRlZmluZWQoaXRlbVtmaWVsZF0pID8gbnVsbCA6IGl0ZW1bZmllbGRdXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICR0YWJsZS5jcmVhdGVEYXRhKHJlY29yZHMpXHJcbiAgICAgICAgICAgICAgLnRoZW4oKGRhdGE6IGFueVtdKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbG9hZFJlc3Q6IFByb21pc2U8YW55PlxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZSA9PT0gJ2luc2VydCcpIHtcclxuICAgICAgICAgICAgICAgICAgbG9hZFJlc3QgPSAkdGFibGUuaW5zZXJ0QXQoZGF0YSwgLTEpXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBsb2FkUmVzdCA9ICR0YWJsZS5yZWxvYWREYXRhKGRhdGEpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbG9hZFJlc3QudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChfaW1wb3J0UmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9pbXBvcnRSZXNvbHZlKHsgc3RhdHVzOiB0cnVlIH0pXHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcclxuICAgICAgICAgICAgICBtb2RhbC5tZXNzYWdlKHsgY29udGVudDogdCgndnhlLnRhYmxlLmltcFN1Y2Nlc3MnLCBbcmVjb3Jkcy5sZW5ndGhdKSwgc3RhdHVzOiAnc3VjY2VzcycgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKVxyXG4gICAgfVxyXG4gIH1cclxuICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUltcG9ydEV2ZW50IChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckltcG9ydFBhcmFtcykge1xyXG4gIGlmIChwYXJhbXMub3B0aW9ucy50eXBlID09PSAneGxzeCcpIHtcclxuICAgIGltcG9ydFhMU1gocGFyYW1zKVxyXG4gICAgcmV0dXJuIGZhbHNlXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFeHBvcnRFdmVudCAocGFyYW1zOiBWeGVHbG9iYWxJbnRlcmNlcHRvckhhbmRsZXMuSW50ZXJjZXB0b3JFeHBvcnRQYXJhbXMpIHtcclxuICBpZiAocGFyYW1zLm9wdGlvbnMudHlwZSA9PT0gJ3hsc3gnKSB7XHJcbiAgICBleHBvcnRYTFNYKHBhcmFtcylcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOWfuuS6jiB2eGUtdGFibGUg6KGo5qC855qE5aKe5by65o+S5Lu277yM5pSv5oyB5a+85Ye6IHhsc3gg5qC85byPXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYID0ge1xyXG4gIGluc3RhbGwgKHZ4ZXRhYmxlY29yZTogVlhFVGFibGVDb3JlKSB7XHJcbiAgICBjb25zdCB7IHNldHVwLCBpbnRlcmNlcHRvciB9ID0gdnhldGFibGVjb3JlXHJcblxyXG4gICAgdnhldGFibGUgPSB2eGV0YWJsZWNvcmVcclxuXHJcbiAgICBzZXR1cCh7XHJcbiAgICAgIGV4cG9ydDoge1xyXG4gICAgICAgIHR5cGVzOiB7XHJcbiAgICAgICAgICB4bHN4OiAwXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgaW50ZXJjZXB0b3IubWl4aW4oe1xyXG4gICAgICAnZXZlbnQuaW1wb3J0JzogaGFuZGxlSW1wb3J0RXZlbnQsXHJcbiAgICAgICdldmVudC5leHBvcnQnOiBoYW5kbGVFeHBvcnRFdmVudFxyXG4gICAgfSlcclxuICB9XHJcbn1cclxuXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUgJiYgd2luZG93LlZYRVRhYmxlLnVzZSkge1xyXG4gIHdpbmRvdy5WWEVUYWJsZS51c2UoVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYKVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBWWEVUYWJsZVBsdWdpbkV4cG9ydFhMU1hcclxuIiwiaW1wb3J0IFhFVXRpbHMgZnJvbSAneGUtdXRpbHMnO1xuaW1wb3J0IEV4Y2VsSlMgZnJvbSAnZXhjZWxqcyc7XG5sZXQgdnhldGFibGU7XG5jb25zdCBkZWZhdWx0SGVhZGVyQmFja2dyb3VuZENvbG9yID0gJ2Y4ZjhmOSc7XG5jb25zdCBkZWZhdWx0Q2VsbEZvbnRDb2xvciA9ICc2MDYyNjYnO1xuY29uc3QgZGVmYXVsdENlbGxCb3JkZXJTdHlsZSA9ICd0aGluJztcbmNvbnN0IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3IgPSAnZThlYWVjJztcbmZ1bmN0aW9uIGdldENlbGxMYWJlbChjb2x1bW4sIGNlbGxWYWx1ZSkge1xuICAgIGlmIChjZWxsVmFsdWUpIHtcbiAgICAgICAgc3dpdGNoIChjb2x1bW4uY2VsbFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFhFVXRpbHMudG9WYWx1ZVN0cmluZyhjZWxsVmFsdWUpO1xuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbGxWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcihjZWxsVmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKGNlbGxWYWx1ZS5sZW5ndGggPCAxMiAmJiAhaXNOYU4oY2VsbFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKGNlbGxWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjZWxsVmFsdWU7XG59XG5mdW5jdGlvbiBnZXRGb290ZXJEYXRhKG9wdHMsIGZvb3RlckRhdGEpIHtcbiAgICBjb25zdCB7IGZvb3RlckZpbHRlck1ldGhvZCB9ID0gb3B0cztcbiAgICByZXR1cm4gZm9vdGVyRmlsdGVyTWV0aG9kID8gZm9vdGVyRGF0YS5maWx0ZXIoKGl0ZW1zLCBpbmRleCkgPT4gZm9vdGVyRmlsdGVyTWV0aG9kKHsgaXRlbXMsICRyb3dJbmRleDogaW5kZXggfSkpIDogZm9vdGVyRGF0YTtcbn1cbmZ1bmN0aW9uIGdldEZvb3RlckNlbGxWYWx1ZSgkdGFibGUsIG9wdHMsIHJvd3MsIGNvbHVtbikge1xuICAgIGNvbnN0IGNlbGxWYWx1ZSA9IGdldENlbGxMYWJlbChjb2x1bW4sIHJvd3NbJHRhYmxlLmdldFZNQ29sdW1uSW5kZXgoY29sdW1uKV0pO1xuICAgIHJldHVybiBjZWxsVmFsdWU7XG59XG5mdW5jdGlvbiBnZXRWYWxpZENvbHVtbihjb2x1bW4pIHtcbiAgICBjb25zdCB7IGNoaWxkTm9kZXMgfSA9IGNvbHVtbjtcbiAgICBjb25zdCBpc0NvbEdyb3VwID0gY2hpbGROb2RlcyAmJiBjaGlsZE5vZGVzLmxlbmd0aDtcbiAgICBpZiAoaXNDb2xHcm91cCkge1xuICAgICAgICByZXR1cm4gZ2V0VmFsaWRDb2x1bW4oY2hpbGROb2Rlc1swXSk7XG4gICAgfVxuICAgIHJldHVybiBjb2x1bW47XG59XG5mdW5jdGlvbiBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgaGVpZ2h0KSB7XG4gICAgaWYgKGhlaWdodCkge1xuICAgICAgICBleGNlbFJvdy5oZWlnaHQgPSBYRVV0aWxzLmZsb29yKGhlaWdodCAqIDAuNzUsIDEyKTtcbiAgICB9XG59XG5mdW5jdGlvbiBzZXRFeGNlbENlbGxTdHlsZShleGNlbENlbGwsIGFsaWduKSB7XG4gICAgZXhjZWxDZWxsLnByb3RlY3Rpb24gPSB7XG4gICAgICAgIGxvY2tlZDogZmFsc2VcbiAgICB9O1xuICAgIGV4Y2VsQ2VsbC5hbGlnbm1lbnQgPSB7XG4gICAgICAgIHZlcnRpY2FsOiAnbWlkZGxlJyxcbiAgICAgICAgaG9yaXpvbnRhbDogYWxpZ24gfHwgJ2xlZnQnXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldERlZmF1bHRCb3JkZXJTdHlsZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0b3A6IHtcbiAgICAgICAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxuICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGxlZnQ6IHtcbiAgICAgICAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxuICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJvdHRvbToge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmlnaHQ6IHtcbiAgICAgICAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxuICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuZnVuY3Rpb24gZXhwb3J0WExTWChwYXJhbXMpIHtcbiAgICBjb25zdCBtc2dLZXkgPSAneGxzeCc7XG4gICAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGU7XG4gICAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMsIGNvbHVtbnMsIGNvbGdyb3VwcywgZGF0YXMgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IHByb3BzLCByZWFjdERhdGEgfSA9ICR0YWJsZTtcbiAgICBjb25zdCB7IGhlYWRlckFsaWduOiBhbGxIZWFkZXJBbGlnbiwgYWxpZ246IGFsbEFsaWduLCBmb290ZXJBbGlnbjogYWxsRm9vdGVyQWxpZ24gfSA9IHByb3BzO1xuICAgIGNvbnN0IHsgcm93SGVpZ2h0IH0gPSByZWFjdERhdGE7XG4gICAgY29uc3QgeyBtZXNzYWdlLCBzaGVldE5hbWUsIGlzSGVhZGVyLCBpc0Zvb3RlciwgaXNNZXJnZSwgaXNDb2xncm91cCwgb3JpZ2luYWwsIHVzZVN0eWxlLCBzaGVldE1ldGhvZCB9ID0gb3B0aW9ucztcbiAgICBjb25zdCBzaG93TXNnID0gbWVzc2FnZSAhPT0gZmFsc2U7XG4gICAgY29uc3QgbWVyZ2VDZWxscyA9ICR0YWJsZS5nZXRNZXJnZUNlbGxzKCk7XG4gICAgY29uc3QgY29sTGlzdCA9IFtdO1xuICAgIGNvbnN0IGZvb3RMaXN0ID0gW107XG4gICAgY29uc3Qgc2hlZXRDb2xzID0gW107XG4gICAgY29uc3Qgc2hlZXRNZXJnZXMgPSBbXTtcbiAgICBsZXQgYmVmb3JlUm93Q291bnQgPSAwO1xuICAgIGNvbnN0IGNvbEhlYWQgPSB7fTtcbiAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICBjb25zdCB7IGlkLCBwcm9wZXJ0eSwgcmVuZGVyV2lkdGggfSA9IGNvbHVtbjtcbiAgICAgICAgY29sSGVhZFtpZF0gPSBvcmlnaW5hbCA/IHByb3BlcnR5IDogY29sdW1uLmdldFRpdGxlKCk7XG4gICAgICAgIHNoZWV0Q29scy5wdXNoKHtcbiAgICAgICAgICAgIGtleTogaWQsXG4gICAgICAgICAgICB3aWR0aDogWEVVdGlscy5jZWlsKHJlbmRlcldpZHRoIC8gOCwgMSlcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgLy8g5aSE55CG6KGo5aS0XG4gICAgaWYgKGlzSGVhZGVyKSB7XG4gICAgICAgIC8vIOWkhOeQhuWIhue7hFxuICAgICAgICBpZiAoaXNDb2xncm91cCAmJiAhb3JpZ2luYWwgJiYgY29sZ3JvdXBzKSB7XG4gICAgICAgICAgICBjb2xncm91cHMuZm9yRWFjaCgoY29scywgckluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBIZWFkID0ge307XG4gICAgICAgICAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBIZWFkW2NvbHVtbi5pZF0gPSBudWxsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbHMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgX2NvbFNwYW4sIF9yb3dTcGFuIH0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkQ29sdW1uID0gZ2V0VmFsaWRDb2x1bW4oY29sdW1uKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sdW1uSW5kZXggPSBjb2x1bW5zLmluZGV4T2YodmFsaWRDb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICBncm91cEhlYWRbdmFsaWRDb2x1bW4uaWRdID0gb3JpZ2luYWwgPyB2YWxpZENvbHVtbi5wcm9wZXJ0eSA6IGNvbHVtbi5nZXRUaXRsZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoX2NvbFNwYW4gPiAxIHx8IF9yb3dTcGFuID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogeyByOiBySW5kZXgsIGM6IGNvbHVtbkluZGV4IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZTogeyByOiBySW5kZXggKyBfcm93U3BhbiAtIDEsIGM6IGNvbHVtbkluZGV4ICsgX2NvbFNwYW4gLSAxIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29sTGlzdC5wdXNoKGdyb3VwSGVhZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbExpc3QucHVzaChjb2xIZWFkKTtcbiAgICAgICAgfVxuICAgICAgICBiZWZvcmVSb3dDb3VudCArPSBjb2xMaXN0Lmxlbmd0aDtcbiAgICB9XG4gICAgLy8g5aSE55CG5ZCI5bm2XG4gICAgaWYgKGlzTWVyZ2UgJiYgIW9yaWdpbmFsKSB7XG4gICAgICAgIG1lcmdlQ2VsbHMuZm9yRWFjaChtZXJnZUl0ZW0gPT4ge1xuICAgICAgICAgICAgY29uc3QgeyByb3c6IG1lcmdlUm93SW5kZXgsIHJvd3NwYW46IG1lcmdlUm93c3BhbiwgY29sOiBtZXJnZUNvbEluZGV4LCBjb2xzcGFuOiBtZXJnZUNvbHNwYW4gfSA9IG1lcmdlSXRlbTtcbiAgICAgICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgIHM6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50LCBjOiBtZXJnZUNvbEluZGV4IH0sXG4gICAgICAgICAgICAgICAgZTogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQgKyBtZXJnZVJvd3NwYW4gLSAxLCBjOiBtZXJnZUNvbEluZGV4ICsgbWVyZ2VDb2xzcGFuIC0gMSB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHJvd0xpc3QgPSBkYXRhcy5tYXAoaXRlbSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3QgPSB7fTtcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgIHJlc3RbY29sdW1uLmlkXSA9IGdldENlbGxMYWJlbChjb2x1bW4sIGl0ZW1bY29sdW1uLmlkXSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdDtcbiAgICB9KTtcbiAgICBiZWZvcmVSb3dDb3VudCArPSByb3dMaXN0Lmxlbmd0aDtcbiAgICAvLyDlpITnkIbooajlsL5cbiAgICBpZiAoaXNGb290ZXIpIHtcbiAgICAgICAgY29uc3QgeyBmb290ZXJEYXRhIH0gPSAkdGFibGUuZ2V0VGFibGVEYXRhKCk7XG4gICAgICAgIGNvbnN0IGZvb3RlcnMgPSBnZXRGb290ZXJEYXRhKG9wdGlvbnMsIGZvb3RlckRhdGEpO1xuICAgICAgICBjb25zdCBtZXJnZUZvb3Rlckl0ZW1zID0gJHRhYmxlLmdldE1lcmdlRm9vdGVySXRlbXMoKTtcbiAgICAgICAgLy8g5aSE55CG5ZCI5bm2XG4gICAgICAgIGlmIChpc01lcmdlICYmICFvcmlnaW5hbCkge1xuICAgICAgICAgICAgbWVyZ2VGb290ZXJJdGVtcy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyByb3c6IG1lcmdlUm93SW5kZXgsIHJvd3NwYW46IG1lcmdlUm93c3BhbiwgY29sOiBtZXJnZUNvbEluZGV4LCBjb2xzcGFuOiBtZXJnZUNvbHNwYW4gfSA9IG1lcmdlSXRlbTtcbiAgICAgICAgICAgICAgICBzaGVldE1lcmdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcbiAgICAgICAgICAgICAgICAgICAgZTogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQgKyBtZXJnZVJvd3NwYW4gLSAxLCBjOiBtZXJnZUNvbEluZGV4ICsgbWVyZ2VDb2xzcGFuIC0gMSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmb290ZXJzLmZvckVhY2goKHJvd3MpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB7fTtcbiAgICAgICAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgICAgICAgICAgaXRlbVtjb2x1bW4uaWRdID0gZ2V0Rm9vdGVyQ2VsbFZhbHVlKCR0YWJsZSwgb3B0aW9ucywgcm93cywgY29sdW1uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9vdExpc3QucHVzaChpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGV4cG9ydE1ldGhvZCA9ICgpID0+IHtcbiAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpO1xuICAgICAgICBjb25zdCBzaGVldCA9IHdvcmtib29rLmFkZFdvcmtzaGVldChzaGVldE5hbWUpO1xuICAgICAgICB3b3JrYm9vay5jcmVhdG9yID0gJ3Z4ZS10YWJsZSc7XG4gICAgICAgIHNoZWV0LmNvbHVtbnMgPSBzaGVldENvbHM7XG4gICAgICAgIGlmIChpc0hlYWRlcikge1xuICAgICAgICAgICAgc2hlZXQuYWRkUm93cyhjb2xMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxSb3dIZWlnaHQoZXhjZWxSb3csIHJvd0hlaWdodCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsQ29sID0gc2hlZXQuZ2V0Q29sdW1uKGV4Y2VsQ2VsbC5jb2wpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGhlYWRlckFsaWduLCBhbGlnbiB9ID0gY29sdW1uO1xuICAgICAgICAgICAgICAgICAgICBzZXRFeGNlbENlbGxTdHlsZShleGNlbENlbGwsIGhlYWRlckFsaWduIHx8IGFsaWduIHx8IGFsbEhlYWRlckFsaWduIHx8IGFsbEFsaWduKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZVN0eWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9sZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3BhdHRlcm4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiAnc29saWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZ0NvbG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0SGVhZGVyQmFja2dyb3VuZENvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogZ2V0RGVmYXVsdEJvcmRlclN0eWxlKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBzaGVldC5hZGRSb3dzKHJvd0xpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xuICAgICAgICAgICAgaWYgKHVzZVN0eWxlKSB7XG4gICAgICAgICAgICAgICAgc2V0RXhjZWxSb3dIZWlnaHQoZXhjZWxSb3csIHJvd0hlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleGNlbFJvdy5lYWNoQ2VsbChleGNlbENlbGwgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsQ29sID0gc2hlZXQuZ2V0Q29sdW1uKGV4Y2VsQ2VsbC5jb2wpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUlkKGV4Y2VsQ29sLmtleSk7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBhbGlnbiB9ID0gY29sdW1uO1xuICAgICAgICAgICAgICAgIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgYWxpZ24gfHwgYWxsQWxpZ24pO1xuICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogZ2V0RGVmYXVsdEJvcmRlclN0eWxlKClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoaXNGb290ZXIpIHtcbiAgICAgICAgICAgIHNoZWV0LmFkZFJvd3MoZm9vdExpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXhjZWxSb3cuZWFjaENlbGwoZXhjZWxDZWxsID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUlkKGV4Y2VsQ29sLmtleSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZm9vdGVyQWxpZ24sIGFsaWduIH0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgZm9vdGVyQWxpZ24gfHwgYWxpZ24gfHwgYWxsRm9vdGVyQWxpZ24gfHwgYWxsQWxpZ24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXhjZWxDZWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxGb250Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1c2VTdHlsZSAmJiBzaGVldE1ldGhvZCkge1xuICAgICAgICAgICAgc2hlZXRNZXRob2QoeyBvcHRpb25zOiBvcHRpb25zLCB3b3JrYm9vaywgd29ya3NoZWV0OiBzaGVldCwgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcywgJHRhYmxlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHNoZWV0TWVyZ2VzLmZvckVhY2goKHsgcywgZSB9KSA9PiB7XG4gICAgICAgICAgICBzaGVldC5tZXJnZUNlbGxzKHMuciArIDEsIHMuYyArIDEsIGUuciArIDEsIGUuYyArIDEpO1xuICAgICAgICB9KTtcbiAgICAgICAgd29ya2Jvb2sueGxzeC53cml0ZUJ1ZmZlcigpLnRoZW4oYnVmZmVyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYnVmZmVyXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyB9KTtcbiAgICAgICAgICAgIC8vIOWvvOWHuiB4bHN4XG4gICAgICAgICAgICBkb3dubG9hZEZpbGUocGFyYW1zLCBibG9iLCBvcHRpb25zKTtcbiAgICAgICAgICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XG4gICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UobXNnS2V5KTtcbiAgICAgICAgICAgICAgICBtb2RhbC5tZXNzYWdlKHsgY29udGVudDogdCgndnhlLnRhYmxlLmV4cFN1Y2Nlc3MnKSwgc3RhdHVzOiAnc3VjY2VzcycgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcbiAgICAgICAgbW9kYWwubWVzc2FnZSh7IGlkOiBtc2dLZXksIGNvbnRlbnQ6IHQoJ3Z4ZS50YWJsZS5leHBMb2FkaW5nJyksIHN0YXR1czogJ2xvYWRpbmcnLCBkdXJhdGlvbjogLTEgfSk7XG4gICAgICAgIHNldFRpbWVvdXQoZXhwb3J0TWV0aG9kLCAxNTAwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydE1ldGhvZCgpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRvd25sb2FkRmlsZShwYXJhbXMsIGJsb2IsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZTtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIGZpbGVuYW1lLCB0eXBlIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IHNob3dNc2cgPSBtZXNzYWdlICE9PSBmYWxzZTtcbiAgICBpZiAod2luZG93LkJsb2IpIHtcbiAgICAgICAgaWYgKG5hdmlnYXRvci5tc1NhdmVCbG9iKSB7XG4gICAgICAgICAgICBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBgJHtmaWxlbmFtZX0uJHt0eXBlfWApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbGlua0VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgICAgICBsaW5rRWxlbS50YXJnZXQgPSAnX2JsYW5rJztcbiAgICAgICAgICAgIGxpbmtFbGVtLmRvd25sb2FkID0gYCR7ZmlsZW5hbWV9LiR7dHlwZX1gO1xuICAgICAgICAgICAgbGlua0VsZW0uaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmtFbGVtKTtcbiAgICAgICAgICAgIGxpbmtFbGVtLmNsaWNrKCk7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmtFbGVtKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcbiAgICAgICAgICAgIG1vZGFsLmFsZXJ0KHsgY29udGVudDogdCgndnhlLmVycm9yLm5vdEV4cCcpLCBzdGF0dXM6ICdlcnJvcicgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBjaGVja0ltcG9ydERhdGEodGFibGVGaWVsZHMsIGZpZWxkcykge1xuICAgIHJldHVybiBmaWVsZHMuc29tZShmaWVsZCA9PiB0YWJsZUZpZWxkcy5pbmRleE9mKGZpZWxkKSA+IC0xKTtcbn1cbmZ1bmN0aW9uIGltcG9ydEVycm9yKHBhcmFtcykge1xuICAgIGNvbnN0IHsgbW9kYWwsIHQgfSA9IHZ4ZXRhYmxlO1xuICAgIGNvbnN0IHsgJHRhYmxlLCBvcHRpb25zIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgeyBpbnRlcm5hbERhdGEgfSA9ICR0YWJsZTtcbiAgICBjb25zdCB7IF9pbXBvcnRSZWplY3QgfSA9IGludGVybmFsRGF0YTtcbiAgICBjb25zdCBzaG93TXNnID0gb3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZTtcbiAgICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xuICAgICAgICBtb2RhbC5tZXNzYWdlKHsgY29udGVudDogdCgndnhlLmVycm9yLmltcEZpZWxkcycpLCBzdGF0dXM6ICdlcnJvcicgfSk7XG4gICAgfVxuICAgIGlmIChfaW1wb3J0UmVqZWN0KSB7XG4gICAgICAgIF9pbXBvcnRSZWplY3QoeyBzdGF0dXM6IGZhbHNlIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGltcG9ydFhMU1gocGFyYW1zKSB7XG4gICAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGU7XG4gICAgY29uc3QgeyAkdGFibGUsIGNvbHVtbnMsIG9wdGlvbnMsIGZpbGUgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IGludGVybmFsRGF0YSB9ID0gJHRhYmxlO1xuICAgIGNvbnN0IHsgX2ltcG9ydFJlc29sdmUgfSA9IGludGVybmFsRGF0YTtcbiAgICBjb25zdCBzaG93TXNnID0gb3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZTtcbiAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIGltcG9ydEVycm9yKHBhcmFtcyk7XG4gICAgfTtcbiAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IChldm50KSA9PiB7XG4gICAgICAgIGNvbnN0IHRhYmxlRmllbGRzID0gW107XG4gICAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZCA9IGNvbHVtbi5wcm9wZXJ0eTtcbiAgICAgICAgICAgIGlmIChmaWVsZCkge1xuICAgICAgICAgICAgICAgIHRhYmxlRmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpO1xuICAgICAgICBjb25zdCByZWFkZXJUYXJnZXQgPSBldm50LnRhcmdldDtcbiAgICAgICAgaWYgKHJlYWRlclRhcmdldCkge1xuICAgICAgICAgICAgd29ya2Jvb2sueGxzeC5sb2FkKHJlYWRlclRhcmdldC5yZXN1bHQpLnRoZW4od2IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0U2hlZXQgPSB3Yi53b3Jrc2hlZXRzWzBdO1xuICAgICAgICAgICAgICAgIGlmIChmaXJzdFNoZWV0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoZWV0VmFsdWVzID0gZmlyc3RTaGVldC5nZXRTaGVldFZhbHVlcygpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZEluZGV4ID0gWEVVdGlscy5maW5kSW5kZXhPZihzaGVldFZhbHVlcywgKGxpc3QpID0+IGxpc3QgJiYgbGlzdC5sZW5ndGggPiAwKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRzID0gc2hlZXRWYWx1ZXNbZmllbGRJbmRleF07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGNoZWNrSW1wb3J0RGF0YSh0YWJsZUZpZWxkcywgZmllbGRzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IHNoZWV0VmFsdWVzLnNsaWNlKGZpZWxkSW5kZXgpLm1hcChsaXN0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5mb3JFYWNoKChjZWxsVmFsdWUsIGNJbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW2ZpZWxkc1tjSW5kZXhdXSA9IGNlbGxWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmQgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkW2ZpZWxkXSA9IFhFVXRpbHMuaXNVbmRlZmluZWQoaXRlbVtmaWVsZF0pID8gbnVsbCA6IGl0ZW1bZmllbGRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNvcmQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0YWJsZS5jcmVhdGVEYXRhKHJlY29yZHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbG9hZFJlc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZSA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZFJlc3QgPSAkdGFibGUuaW5zZXJ0QXQoZGF0YSwgLTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZFJlc3QgPSAkdGFibGUucmVsb2FkRGF0YShkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRSZXN0LnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2ltcG9ydFJlc29sdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pbXBvcnRSZXNvbHZlKHsgc3RhdHVzOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwubWVzc2FnZSh7IGNvbnRlbnQ6IHQoJ3Z4ZS50YWJsZS5pbXBTdWNjZXNzJywgW3JlY29yZHMubGVuZ3RoXSksIHN0YXR1czogJ3N1Y2Nlc3MnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGltcG9ydEVycm9yKHBhcmFtcyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7XG59XG5mdW5jdGlvbiBoYW5kbGVJbXBvcnRFdmVudChwYXJhbXMpIHtcbiAgICBpZiAocGFyYW1zLm9wdGlvbnMudHlwZSA9PT0gJ3hsc3gnKSB7XG4gICAgICAgIGltcG9ydFhMU1gocGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhhbmRsZUV4cG9ydEV2ZW50KHBhcmFtcykge1xuICAgIGlmIChwYXJhbXMub3B0aW9ucy50eXBlID09PSAneGxzeCcpIHtcbiAgICAgICAgZXhwb3J0WExTWChwYXJhbXMpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuLyoqXG4gKiDln7rkuo4gdnhlLXRhYmxlIOihqOagvOeahOWinuW8uuaPkuS7tu+8jOaUr+aMgeWvvOWHuiB4bHN4IOagvOW8j1xuICovXG5leHBvcnQgY29uc3QgVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYID0ge1xuICAgIGluc3RhbGwodnhldGFibGVjb3JlKSB7XG4gICAgICAgIGNvbnN0IHsgc2V0dXAsIGludGVyY2VwdG9yIH0gPSB2eGV0YWJsZWNvcmU7XG4gICAgICAgIHZ4ZXRhYmxlID0gdnhldGFibGVjb3JlO1xuICAgICAgICBzZXR1cCh7XG4gICAgICAgICAgICBleHBvcnQ6IHtcbiAgICAgICAgICAgICAgICB0eXBlczoge1xuICAgICAgICAgICAgICAgICAgICB4bHN4OiAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaW50ZXJjZXB0b3IubWl4aW4oe1xuICAgICAgICAgICAgJ2V2ZW50LmltcG9ydCc6IGhhbmRsZUltcG9ydEV2ZW50LFxuICAgICAgICAgICAgJ2V2ZW50LmV4cG9ydCc6IGhhbmRsZUV4cG9ydEV2ZW50XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlZYRVRhYmxlICYmIHdpbmRvdy5WWEVUYWJsZS51c2UpIHtcbiAgICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWCk7XG59XG5leHBvcnQgZGVmYXVsdCBWWEVUYWJsZVBsdWdpbkV4cG9ydFhMU1g7XG4iXX0=
